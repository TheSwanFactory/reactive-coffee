(function(){var t,n,r,e,i,u,o,s,c,a,h,p,l,f,d,g,b,v,y,m,x,w,k,C,S,M,A,D,O,R={}.hasOwnProperty,j=function(t,n){function r(){this.constructor=t}for(var e in n)R.call(n,e)&&(t[e]=n[e]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},P=[].slice,T=[].indexOf||function(t){for(var n=0,r=this.length;r>n;n++)if(n in this&&this[n]===t)return n;return-1},U=this;"undefined"==typeof exports?this.rx=w={}:w=exports,y=0,v=function(){return y+=1},m=function(t,n){var r;if(!n in t)throw"object has no key "+n;return r=t[n],delete t[n],r},a=w.Recorder=function(){function t(){this.stack=[]}return t.prototype.start=function(t){return this.stack.push(t)},t.prototype.stop=function(){return this.stack.pop()},t.prototype.sub=function(t){var n,r;return this.stack.length>0?(r=_(this.stack).last(),n=t(r),r.addSub(n)):void 0},t.prototype.warnMutate=function(){return this.stack.length>0?console.warn("Mutation to observable detected during a bind context"):void 0},t}(),x=new a,w.bind=f=function(t){var n;return n=w.depCell(t),n.refresh(),n},w.lagBind=g=function(t,n){var r;return r=w.lagDepCell(n,t),r.refresh(),r},r=w.DepMgr=function(){function t(){this.uid2src={}}return t.prototype.sub=function(t,n){return this.uid2src[t]=n},t.prototype.unsub=function(t){return this.uid2src[t].unsub(t),m(this.uid2src,t)},t}(),d=new r,i=w.Ev=function(){function t(t){this.inits=t,this.subs=[]}return t.prototype.sub=function(t){var n,r,e,i,u;if(r=v(),null!=this.inits)for(u=this.inits(),e=0,i=u.length;i>e;e++)n=u[e],t(n);return this.subs[r]=t,d.sub(r,this),r},t.prototype.pub=function(t){var n,r,e,i;e=this.subs,i=[];for(r in e)n=e[r],i.push(n(t));return i},t.prototype.unsub=function(t){return m(this.subs,t)},t}(),s=w.ObsCell=function(){function t(t){var n,r=this;this.x=t,this.x=null!=(n=this.x)?n:null,this.onSet=new i(function(){return[[null,r.x]]})}return t.prototype.get=function(){var t=this;return x.sub(function(n){return t.onSet.sub(function(){return n.refresh()})}),this.x},t}(),p=w.SrcCell=function(t){function n(){return M=n.__super__.constructor.apply(this,arguments)}return j(n,t),n.prototype.set=function(t){var n;return x.warnMutate(),n=this.x,this.x=t,this.onSet.pub([n,t]),n},n}(s),n=w.DepCell=function(t){function n(t,r,e){this.body=t,n.__super__.constructor.call(this,null!=r?r:null),this.subs=[],this.refreshing=!1,this.lag=null!=e?e:!1,this.timeout=null}return j(n,t),n.prototype.refresh=function(){var t,n=this;return t=function(){var t,r,e,i,u;if(!n.refreshing){for(t=n.x,u=n.subs,e=0,i=u.length;i>e;e++)r=u[e],d.unsub(r);n.subs=[],x.start(n),n.refreshing=!0;try{n.x=n.body()}finally{n.refreshing=!1,x.stop()}return n.onSet.pub([t,n.x])}},this.refreshing?void 0:this.lag?(null!=this.timeout&&clearTimeout(this.timeout),console.log("setting timeout"),this.timeout=setTimeout(t,500)):t()},n.prototype.addSub=function(t){return this.subs.push(t)},n}(s),o=w.ObsArray=function(){function t(t){var n,r=this;this.xs=t,this.xs=null!=(n=this.xs)?n:[],this.onChange=new i(function(){return[[0,[],r.xs]]})}return t.prototype.all=function(){var t=this;return x.sub(function(n){return t.onChange.sub(function(){return n.refresh()})}),this.xs},t.prototype.at=function(t){var n=this;return x.sub(function(r){return n.onChange.sub(function(n){var e,i,u;return i=n[0],u=n[1],e=n[2],i===t?r.refresh():void 0})}),this.xs[t]},t.prototype.length=function(){var t=this;return x.sub(function(n){return t.onChange.sub(function(t){var r,e,i;return e=t[0],i=t[1],r=t[2],i.length!==r.length?n.refresh():void 0})}),this.xs.length},t.prototype.map=function(t){var n;return n=new u,this.onChange.sub(function(r){var e,i,u;return i=r[0],u=r[1],e=r[2],n.realSplice(i,u.length,e.map(t))}),n},t.prototype.realSplice=function(t,n,r){var e;return e=this.xs.splice.apply(this.xs,[t,n].concat(r)),this.onChange.pub([t,e,r])},t}(),h=w.SrcArray=function(t){function n(){return A=n.__super__.constructor.apply(this,arguments)}return j(n,t),n.prototype.spliceArray=function(t,n,r){return x.warnMutate(),this.realSplice(t,n,r)},n.prototype.splice=function(){var t,n,r;return r=arguments[0],n=arguments[1],t=arguments.length>=3?P.call(arguments,2):[],this.spliceArray(r,n,t)},n.prototype.insert=function(t,n){return this.splice(n,0,t)},n.prototype.remove=function(t){return this.removeAt(_(this.all()).indexOf(t))},n.prototype.removeAt=function(t){return this.splice(t,1)},n.prototype.push=function(t){return this.splice(this.length(),0,t)},n.prototype.put=function(t,n){return this.splice(t,1,n)},n.prototype.replace=function(t){return this.spliceArray(0,this.length(),t)},n}(o),u=w.MappedDepArray=function(t){function n(){return D=n.__super__.constructor.apply(this,arguments)}return j(n,t),n}(o),t=w.DepArray=function(t){function r(t){this.f=t,r.__super__.constructor.call(this),new n(this.f).onSet.sub(function(t){var n,r,e,i,u,o,s;return i=t[0],u=t[1],o=firstWhere(function(){s=[];for(var t=0,n=Math.min(i.length,u.length);n>=0?n>=t:t>=n;n>=0?t++:t--)s.push(t);return s}.apply(this),function(t){return i[t]!==u[t]}),e=o[0],e=o[1],e>-1?(r=i.length-e,n=u.slice(e),this.realSplice(e,r,n)):void 0})}return j(r,t),r}(o),c=w.ObsMap=function(){function t(t){this.x=null!=t?t:{},this.onAdd=new i(function(){var n,r,e;e=[];for(n in t)r=t[n],e.push([n,r]);return e}),this.onRemove=new i,this.onChange=new i}return t.prototype.get=function(t){var n=this;return x.sub(function(r){return n.onChange.sub(function(n){var e,i,u;return i=n[0],e=n[1],u=n[2],t===i?r.refresh():void 0})}),this.x[t]},t.prototype.all=function(){var t=this;return x.sub(function(n){return t.onChange.sub(function(){return n.refresh()})}),_.clone(this.x)},t.prototype.realPut=function(t,n){var r;return T.call(this.x,t)>=0?(r=this.x[t],this.x[t]=n,this.onChange.pub([t,r,n]),r):(this.x[t]=n,this.onAdd.pub([t,n]),void 0)},t.prototype.realRemove=function(t){var n;return n=m(this.x,t),this.onRemove.pub([t,n]),n},t}(),l=w.SrcMap=function(t){function n(){return O=n.__super__.constructor.apply(this,arguments)}return j(n,t),n.prototype.put=function(t,n){return x.warnMutate(),this.realPut(t,n)},n.prototype.remove=function(t){return x.warnMutate(),this.realRemove(t)},n}(c),e=w.DepMap=function(t){function r(t){this.f=t,r.__super__.constructor.call(this),new n(this.f).onSet.sub(function(t){var n,r,e,i,u;r=t[0],i=t[1];for(n in r)e=r[n],!n in i&&this.realRemove(n);u=[];for(n in i)e=i[n],this.x[n]!==e?u.push(this.realPut(n,e)):u.push(void 0);return u})}return j(r,t),r}(c),_.extend(w,{cell:function(t){return new p(t)},array:function(t){return new h(t)},map:function(t){return new l(t)},depCell:function(t){return new n(t)},lagDepCell:function(t,r){return new n(t,r,!0)},depMap:function(t){return new DepMap(t)},depArray:function(n){return new t(n)}}),$.fn.rx=function(t){var n,r,e,i;return e=$(this).data("rx-map"),null==e&&(e=$(this).data("rx-map",mkMap())),T.call(e,t)>=0?e[t]:e[t]=function(){switch(t){case"focused":return r=w.cell($(this).is(":focus")),$(this).focus(function(){return r.set(!0)}),$(this).blur(function(){return r.set(!1)}),f(function(){return r.get()});case"val":return i=w.cell($(this).val()),$(this).change(function(){return i.set(i)}),f(function(){return i.get()});case"checked":return n=w.cell($(this).is(":checked")),$(this).change(function(){return n.set($(this).is(":checked"))}),f(function(){return n.get()});default:throw"Unknown reactive property type"}}.call(this)},"undefined"==typeof exports?this.rxt=k={}:k=exports,k.mktag=b=function(t){return function(n,r){var e,i,u,c,a,h;e=$("<"+t+"/>"),a=_.omit(n,"init");for(i in a)c=a[i],c instanceof s?function(t){return c.onSet.sub(function(n){var r,i;return r=n[0],i=n[1],e.attr(t,i)})}(i):e.attr(i,c);if(null!=r)if(u=function(t){var n,r,i,u;if(e.html(""),_.isArray(t)){for(u=[],r=0,i=t.length;i>r;r++)n=t[r],_.isString(n)&&(n=$("<span/>").text(n)),u.push(e.append(n));return u}throw"Unknown type for contents: "+t.constructor.name},r instanceof o)r.onChange.sub(function(t){var n,r,i,u,o;return i=t[0],u=t[1],n=t[2],e.children().slice(i,i+u.length).remove(),o=$(function(){var t,e,i;for(i=[],t=0,e=n.length;e>t;t++)r=n[t],i.push(r.get(0));return i}()),i===e.children().length?e.append(o):e.children().slice(i,i+1).before(o)});else if(r instanceof s)r.onSet.sub(function(t){var n,r;return n=t[0],r=t[1],u(r)});else{if(!_.isArray(r))throw"Unknown type for contents: "+r.constructor.name;u(r)}return null!=(h=n.init)&&h.call(e),e}},S=["html","head","title","base","link","meta","style","script","noscript","body","body","section","nav","article","aside","h1","h2","h3","h4","h5","h6","h1","h6","header","footer","address","main","main","p","hr","pre","blockquote","ol","ul","li","dl","dt","dd","dd","figure","figcaption","div","a","em","strong","small","s","cite","q","dfn","abbr","data","time","code","var","samp","kbd","sub","sup","i","b","u","mark","ruby","rt","rp","bdi","bdo","span","br","wbr","ins","del","img","iframe","embed","object","param","object","video","audio","source","video","audio","track","video","audio","canvas","map","area","area","map","svg","math","table","caption","colgroup","col","tbody","thead","tfoot","tr","td","th","form","fieldset","legend","fieldset","label","input","button","select","datalist","optgroup","option","select","datalist","textarea","keygen","output","progress","meter","details","summary","details","menuitem","menu"],k.tags=_.object(function(){var t,n,r;for(r=[],t=0,n=S.length;n>t;t++)C=S[t],r.push([C,k.mktag(C)]);return r}()),k.importTags=function(t){return _(null!=t?t:U).extend(k.tags)}}).call(this);