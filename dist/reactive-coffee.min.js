(function(){var t,n,r,e,i,u,o,s,a,c,l,h,f,p,d,g,v,b,y,m,w,x,k,M,A,S,C,j,O,R,I,B,D,P,N,T,U,q,H,F,W,z,E,G,J,K={}.hasOwnProperty,L=function(t,n){function r(){this.constructor=t}for(var e in n)K.call(n,e)&&(t[e]=n[e]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},Q=[].slice,V=this;"undefined"==typeof exports?this.rx=B={}:B=exports,M=0,k=function(){return M+=1},C=function(t,n){var r;if(!n in t)throw"object has no key "+n;return r=t[n],delete t[n],r},S=function(t,n,r){var e,i,u,o;for(e=u=0,o=t.length;o>u;e=++u)if(i=t[e],r(i)&&0>(n-=1))return[i,e];return[null,-1]},y=function(t,n){return S(t,0,n)},w=function(){return Object.create(null)},e=B.DepMgr=function(){function t(){this.uid2src={}}return t.prototype.sub=function(t,n){return this.uid2src[t]=n},t.prototype.unsub=function(t){return this.uid2src[t].unsub(t),C(this.uid2src,t)},t}(),B._depMgr=g=new e,i=B.Ev=function(){function t(t){this.inits=t,this.subs=[]}return t.prototype.sub=function(t){var n,r,e,i,u;if(r=k(),null!=this.inits)for(u=this.inits(),e=0,i=u.length;i>e;e++)n=u[e],t(n);return this.subs[r]=t,g.sub(r,this),r},t.prototype.pub=function(t){var n,r,e,i;e=this.subs,i=[];for(r in e)n=e[r],i.push(n(t));return i},t.prototype.unsub=function(t){return C(this.subs,t)},t.prototype.scoped=function(t,n){var r;r=this.sub(t);try{return n()}finally{this.unsub(r)}},t}(),B.skipFirst=function(t){var n;return n=!0,function(r){return n?n=!1:t(r)}},l=B.Recorder=function(){function t(){this.stack=[],this.isMutating=!1,this.isAllowingMutations=!1,this.isIgnoring=!1,this.onMutationWarning=new i}return t.prototype.record=function(t,n){var r,e,i;this.stack.length>0&&!this.isMutating&&_(this.stack).last().addNestedBind(t),this.stack.push(t),i=this.isMutating,this.isMutating=!1,r=this.isAllowingMutations,this.isAllowingMutations=!1,e=this.isIgnoring,this.isIgnoring=!1;try{return n()}finally{this.isIgnoring=e,this.isAllowingMutations=r,this.isMutating=i,this.stack.pop()}},t.prototype.sub=function(t){var n,r;return this.stack.length>0&&!this.isIgnoring?(r=_(this.stack).last(),n=t(r),r.addSub(n)):void 0},t.prototype.addCleanup=function(t){return this.stack.length>0?_(this.stack).last().addCleanup(t):void 0},t.prototype.mutating=function(t){var n;this.stack.length>0&&!this.isAllowingMutations&&(console.warn("Mutation to observable detected during a bind context"),this.onMutationWarning.pub(null)),n=this.isMutating,this.isMutating=!0;try{return t()}finally{this.isMutating=n}},t.prototype.allowMutations=function(t){var n;n=this.isAllowingMutations,this.isAllowingMutations=!0;try{return t()}finally{this.isAllowingMutations=n}},t.prototype.ignoring=function(t){var n;n=this.isIgnoring,this.isIgnoring=!0;try{return t()}finally{this.isIgnoring=n}},t}(),B._recorder=I=new l,B.allowMutations=function(t){return I.allowMutations(t)},B.bind=d=function(t){var r;return r=new n(t),r.refresh(),r},B.lagBind=m=function(t,r){var e;return e=new n(r,t),e.refresh(),e},B.noSubs=A=function(t){return I.ignoring(t)},B.snap=N=function(t){var r,e;return e=B.noSubs(t),r=new n(function(){return e}),r.refresh(),r},B.onDispose=function(t){return I.addCleanup(t)},s=B.ObsCell=function(){function t(t){var n,r=this;this.x=t,this.x=null!=(n=this.x)?n:null,this.onSet=new i(function(){return[[null,r.x]]})}return t.prototype.get=function(){var t=this;return I.sub(function(n){return t.onSet.sub(function(){return n.refresh()})}),this.x},t}(),f=B.SrcCell=function(t){function n(){return z=n.__super__.constructor.apply(this,arguments)}return L(n,t),n.prototype.set=function(t){var n=this;return I.mutating(function(){var r;return n.x!==t?(r=n.x,n.x=t,n.onSet.pub([r,t]),r):void 0})},n}(s),n=B.DepCell=function(t){function n(t,r,e){this.body=t,n.__super__.constructor.call(this,null!=r?r:null),this.subs=[],this.refreshing=!1,this.lag=null!=e?e:!1,this.timeout=null,this.nestedBinds=[],this.cleanups=[]}return L(n,t),n.prototype.refresh=function(){var t,n=this;return t=function(){var t;if(!n.refreshing){t=n.x,n.disconnect(),n.refreshing=!0;try{n.x=I.record(n,n.body)}finally{n.refreshing=!1}if(t!==n.x)return n.onSet.pub([t,n.x])}},this.refreshing?void 0:this.lag?(null!=this.timeout&&clearTimeout(this.timeout),console.log("setting timeout"),this.timeout=setTimeout(t,500)):t()},n.prototype.disconnect=function(){var t,n,r,e,i,u,o,s,a,c,l,h;for(c=this.cleanups,e=0,o=c.length;o>e;e++)t=c[e],t();for(l=this.subs,i=0,s=l.length;s>i;i++)r=l[i],g.unsub(r);for(h=this.nestedBinds,u=0,a=h.length;a>u;u++)n=h[u],n.disconnect();return this.subs=[],this.nestedBinds=[],this.cleanups=[]},n.prototype.addSub=function(t){return this.subs.push(t)},n.prototype.addNestedBind=function(t){return this.nestedBinds.push(t)},n.prototype.addCleanup=function(t){return this.cleanups.push(t)},n}(s),o=B.ObsArray=function(){function t(t){var n,r=this;this.xs=t,this.xs=null!=(n=this.xs)?n:[],this.onChange=new i(function(){return[[0,[],r.xs]]})}return t.prototype.all=function(){var t=this;return I.sub(function(n){return t.onChange.sub(function(){return n.refresh()})}),_.clone(this.xs)},t.prototype.raw=function(){var t=this;return I.sub(function(n){return t.onChange.sub(function(){return n.refresh()})}),this.xs},t.prototype.at=function(t){var n=this;return I.sub(function(r){return n.onChange.sub(function(n){var e,i,u;return i=n[0],u=n[1],e=n[2],i===t?r.refresh():void 0})}),this.xs[t]},t.prototype.length=function(){var t=this;return I.sub(function(n){return t.onChange.sub(function(t){var r,e,i;return e=t[0],i=t[1],r=t[2],i.length!==r.length?n.refresh():void 0})}),this.xs.length},t.prototype.map=function(t){var n;return n=new u,this.onChange.sub(function(r){var e,i,u;return i=r[0],u=r[1],e=r[2],n.realSplice(i,u.length,e.map(t))}),n},t.prototype.realSplice=function(t,n,r){var e;return e=this.xs.splice.apply(this.xs,[t,n].concat(r)),this.onChange.pub([t,e,r])},t}(),h=B.SrcArray=function(t){function n(){return E=n.__super__.constructor.apply(this,arguments)}return L(n,t),n.prototype.spliceArray=function(t,n,r){var e=this;return I.mutating(function(){return e.realSplice(t,n,r)})},n.prototype.splice=function(){var t,n,r;return r=arguments[0],n=arguments[1],t=arguments.length>=3?Q.call(arguments,2):[],this.spliceArray(r,n,t)},n.prototype.insert=function(t,n){return this.splice(n,0,t)},n.prototype.remove=function(t){return this.removeAt(_(this.raw()).indexOf(t))},n.prototype.removeAt=function(t){return this.splice(t,1)},n.prototype.push=function(t){return this.splice(this.length(),0,t)},n.prototype.put=function(t,n){return this.splice(t,1,n)},n.prototype.replace=function(t){return this.spliceArray(0,this.length(),t)},n}(o),u=B.MappedDepArray=function(t){function n(){return G=n.__super__.constructor.apply(this,arguments)}return L(n,t),n}(o),t=B.DepArray=function(t){function n(t){var r=this;this.f=t,n.__super__.constructor.call(this),d(function(){return r.f()}).onSet.sub(function(t){var n,e,i,u,o,s,a;return u=t[0],o=t[1],null!=u?(s=y(function(){a=[];for(var t=0,n=Math.min(u.length,o.length);n>=0?n>=t:t>=n;n>=0?t++:t--)a.push(t);return a}.apply(this),function(t){return u[t]!==o[t]}),i=s[0],i=s[1]):i=0,i>-1?(e=null!=u?u.length-i:0,n=o.slice(i),r.realSplice(i,e,n)):void 0})}return L(n,t),n}(o),a=B.ObsMap=function(){function t(t){this.x=null!=t?t:{},this.onAdd=new i(function(){var n,r,e;e=[];for(n in t)r=t[n],e.push([n,r]);return e}),this.onRemove=new i,this.onChange=new i}return t.prototype.get=function(t){var n=this;return I.sub(function(r){return n.onAdd.sub(function(n){var e,i;return e=n[0],i=n[1],t===e?r.refresh():void 0})}),I.sub(function(r){return n.onChange.sub(function(n){var e,i,u;return i=n[0],e=n[1],u=n[2],t===i?r.refresh():void 0})}),I.sub(function(r){return n.onRemove.sub(function(n){var e,i;return i=n[0],e=n[1],t===i?r.refresh():void 0})}),this.x[t]},t.prototype.all=function(){var t=this;return I.sub(function(n){return t.onAdd.sub(function(){return n.refresh()})}),I.sub(function(n){return t.onChange.sub(function(){return n.refresh()})}),I.sub(function(n){return t.onRemove.sub(function(){return n.refresh()})}),_.clone(this.x)},t.prototype.realPut=function(t,n){var r;return t in this.x?(r=this.x[t],this.x[t]=n,this.onChange.pub([t,r,n]),r):(this.x[t]=n,this.onAdd.pub([t,n]),void 0)},t.prototype.realRemove=function(t){var n;return n=C(this.x,t),this.onRemove.pub([t,n]),n},t}(),p=B.SrcMap=function(t){function n(){return J=n.__super__.constructor.apply(this,arguments)}return L(n,t),n.prototype.put=function(t,n){var r=this;return I.mutating(function(){return r.realPut(t,n)})},n.prototype.remove=function(t){var n=this;return I.mutating(function(){return n.realRemove(t)})},n}(a),r=B.DepMap=function(t){function r(t){this.f=t,r.__super__.constructor.call(this),new n(this.f).onSet.sub(function(t){var n,r,e,i,u;r=t[0],i=t[1];for(n in r)e=r[n],!n in i&&this.realRemove(n);u=[];for(n in i)e=i[n],this.x[n]!==e?u.push(this.realPut(n,e)):u.push(void 0);return u})}return L(r,t),r}(a),B.reactify=function(t,n){var r,e,i,u;return _.isArray(t)?(r=B.array(_.clone(t)),Object.defineProperties(t,_.object(function(){var n,i,u,o;for(u=_.functions(r),o=[],n=0,i=u.length;i>n;n++)e=u[n],"length"!==e&&o.push(function(n){var e,i,u;return e=t[n],i=function(){var i,u,o;return i=arguments.length>=1?Q.call(arguments,0):[],null!=e&&(u=e.call.apply(e,[t].concat(Q.call(i)))),(o=r[n]).call.apply(o,[r].concat(Q.call(i))),u},u={configurable:!0,enumerable:!1,value:i,writable:!0},[n,u]}(e));return o}())),t):Object.defineProperties(t,_.object(function(){var t;t=[];for(i in n)u=n[i],t.push(function(t,n){var r,e,i,u,o;switch(r=null,n.type){case"cell":e=B.cell(null!=(u=n.val)?u:null),r={configurable:!0,enumerable:!0,get:function(){return e.get()},set:function(t){return e.set(t)}};break;case"array":i=B.reactify(null!=(o=n.val)?o:[]),r={configurable:!0,enumerable:!0,get:function(){return i.raw(),i},set:function(t){return i.splice.apply(i,[0,i.length].concat(Q.call(t))),i}};break;default:throw"Unknown observable type: "+type}return[t,r]}(i,u));return t}()))},B.autoReactify=function(t){var n,r,e;return B.reactify(t,_.object(function(){var i,u,o,s;for(o=Object.getOwnPropertyNames(t),s=[],i=0,u=o.length;u>i;i++)n=o[i],e=t[n],r=_.isFunction(e)?null:_.isArray(e)?"array":"cell",s.push([n,{type:r,val:e}]);return s}()))},_.extend(B,{cell:function(t){return new f(t)},array:function(t){return new h(t)},map:function(t){return new p(t)}}),B.flatten=function(n){return new t(function(){var t;return _(function(){var r,e,i;for(i=[],r=0,e=n.length;e>r;r++)t=n[r],t instanceof o?i.push(t.raw()):t instanceof s?i.push(t.get()):i.push(t);return i}()).chain().flatten(!0).filter(function(t){return null!=t}).value()})},$.fn.rx=function(t){var n,r,e,i;return e=this.data("rx-map"),null==e&&this.data("rx-map",e=w()),t in e?e[t]:e[t]=function(){var e=this;switch(t){case"focused":return r=B.cell(this.is(":focus")),this.focus(function(){return r.set(!0)}),this.blur(function(){return r.set(!1)}),r;case"val":return i=B.cell(this.val()),this.change(function(){return i.set(e.val())}),this.on("input",function(){return i.set(e.val())}),i;case"checked":return n=B.cell(this.is(":checked")),this.change(function(){return n.set(e.is(":checked"))}),n;default:throw"Unknown reactive property type"}}.call(this)},"undefined"==typeof exports?this.rxt=D={}:D=exports,c=D.RawHtml=function(){function t(t){this.html=t}return t}(),b=["blur","change","click","dblclick","error","focus","focusin","focusout","hover","keydown","keypress","keyup","load","mousedown","mouseenter","mouseleave","mousemove","mouseout","mouseover","mouseup","ready","resize","scroll","select","submit","toggle","unload"],T=D.specialAttrs={init:function(t,n){return n.call(t)}},H=function(t){return T[t]=function(n,r){return n[t](function(t){return r.call(n,t)})}};for(F=0,W=b.length;W>F;F++)v=b[F],H(v);R=["async","autofocus","checked","location","multiple","readOnly","selected","selectedIndex","tagName","nodeName","nodeType","ownerDocument","defaultChecked","defaultSelected"],O=_.object(function(){var t,n,r;for(r=[],t=0,n=R.length;n>t;t++)j=R[t],r.push([j,null]);return r}()),P=function(t,n,r){return"value"===n?t.val(r):n in O?t.prop(n,r):t.attr(n,r)},D.mktag=x=function(t){return function(n,r){var e,i,u,a,l,h,f,p,d,g;d=null==n&&null==r?[{},null]:null!=r?[n,r]:_.isString(n)||n instanceof c||_.isArray(n)||n instanceof s||n instanceof o?[{},n]:[n,null],e=d[0],i=d[1],u=$("<"+t+"/>"),g=_.omit(e,_.keys(T));for(l in g)p=g[l],p instanceof s?function(t){return p.onSet.sub(function(n){var r,e;return r=n[0],e=n[1],P(u,t,e)})}(l):P(u,l,p);null!=i&&(h=function(t){var n,r,e,i,u;for(u=[],e=0,i=t.length;i>e;e++)if(n=t[e],_.isString(n))u.push(document.createTextNode(n));else if(n instanceof c){if(r=$(n.html),r.length)throw"Cannot insert RawHtml of multiple elements";u.push(r[0])}else{if(!(n instanceof $))throw"Unknown element type in array: "+n.constructor.name;u.push(n[0])}return u},f=function(t){var n;if(u.html(""),!_.isArray(t)){if(_.isString(t)||t instanceof c)return f([t]);throw"Unknown type for contents: "+t.constructor.name}n=h(t),u.append(n)},i instanceof o?i.onChange.sub(function(t){var n,r,e,i;return r=t[0],e=t[1],n=t[2],u.contents().slice(r,r+e.length).remove(),i=h(n),r===u.contents().length?u.append(i):u.contents().eq(r).before(i)}):i instanceof s?i.onSet.sub(function(t){var n,r;return n=t[0],r=t[1],f(r)}):f(i));for(a in e)a in T&&T[a](u,e[a],e,i);return u}},q=["html","head","title","base","link","meta","style","script","noscript","body","body","section","nav","article","aside","h1","h2","h3","h4","h5","h6","h1","h6","header","footer","address","main","main","p","hr","pre","blockquote","ol","ul","li","dl","dt","dd","dd","figure","figcaption","div","a","em","strong","small","s","cite","q","dfn","abbr","data","time","code","var","samp","kbd","sub","sup","i","b","u","mark","ruby","rt","rp","bdi","bdo","span","br","wbr","ins","del","img","iframe","embed","object","param","object","video","audio","source","video","audio","track","video","audio","canvas","map","area","area","map","svg","math","table","caption","colgroup","col","tbody","thead","tfoot","tr","td","th","form","fieldset","legend","fieldset","label","input","button","select","datalist","optgroup","option","select","datalist","textarea","keygen","output","progress","meter","details","summary","details","menuitem","menu"],D.tags=_.object(function(){var t,n,r;for(r=[],t=0,n=q.length;n>t;t++)U=q[t],r.push([U,D.mktag(U)]);return r}()),D.rawHtml=function(t){return new c(t)},D.importTags=function(t){return _(null!=t?t:V).extend(D.tags)}}).call(this);