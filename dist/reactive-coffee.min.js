(function(){var t,n,r,e,u,i,o,s,c,h,a,p,f,l,g,v,y,d,b,x,m,w,C,S,k,M,A,D={}.hasOwnProperty,O=function(t,n){function r(){this.constructor=t}for(var e in n)D.call(n,e)&&(t[e]=n[e]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},R=[].slice,P=[].indexOf||function(t){for(var n=0,r=this.length;r>n;n++)if(n in this&&this[n]===t)return n;return-1};"undefined"==typeof exports?this.rx=w={}:w=exports,b=0,d=function(){return b+=1},x=function(t,n){var r;if(!n in t)throw"object has no key "+n;return r=t[n],delete t[n],r},h=w.Recorder=function(){function t(){this.stack=[]}return t.prototype.start=function(t){return this.stack.push(t)},t.prototype.stop=function(){return this.stack.pop()},t.prototype.sub=function(t){var n,r;return this.stack.length>0?(r=_(this.stack).last(),n=t(r),r.addSub(n)):void 0},t.prototype.warnMutate=function(){return this.stack.length>0?console.warn("Mutation to observable detected during a bind context"):void 0},t}(),m=new h,w.bind=l=function(t){var n;return n=w.depCell(t),n.refresh(),n},w.lagBind=v=function(t,n){var r;return r=w.lagDepCell(n,t),r.refresh(),r},r=w.DepMgr=function(){function t(){this.uid2src={}}return t.prototype.sub=function(t,n){return this.uid2src[t]=n},t.prototype.unsub=function(t){return this.uid2src[t].unsub(t),x(this.uid2src,t)},t}(),g=new r,u=w.Ev=function(){function t(t){this.inits=t,this.subs=[]}return t.prototype.sub=function(t){var n,r,e,u,i;if(r=d(),null!=this.inits)for(i=this.inits(),e=0,u=i.length;u>e;e++)n=i[e],t(n);return this.subs[r]=t,g.sub(r,this),r},t.prototype.pub=function(t){var n,r,e,u;e=this.subs,u=[];for(r in e)n=e[r],u.push(n(t));return u},t.prototype.unsub=function(t){return x(this.subs,t)},t}(),s=w.ObsCell=function(){function t(t){var n,r=this;this.x=t,this.x=null!=(n=this.x)?n:null,this.onSet=new u(function(){return[[null,r.x]]})}return t.prototype.get=function(){var t=this;return m.sub(function(n){return t.onSet.sub(function(){return n.refresh()})}),this.x},t}(),p=w.SrcCell=function(t){function n(){return S=n.__super__.constructor.apply(this,arguments)}return O(n,t),n.prototype.set=function(t){var n;return m.warnMutate(),n=this.x,this.x=t,this.onSet.pub([n,t]),n},n}(s),n=w.DepCell=function(t){function n(t,r,e){this.body=t,n.__super__.constructor.call(this,null!=r?r:null),this.subs=[],this.refreshing=!1,this.lag=null!=e?e:!1,this.timeout=null}return O(n,t),n.prototype.refresh=function(){var t,n=this;return t=function(){var t,r,e,u,i;if(!n.refreshing){for(t=n.x,i=n.subs,e=0,u=i.length;u>e;e++)r=i[e],g.unsub(r);n.subs=[],m.start(n),n.refreshing=!0;try{n.x=n.body()}finally{n.refreshing=!1,m.stop()}return n.onSet.pub([t,n.x])}},this.refreshing?void 0:this.lag?(null!=this.timeout&&clearTimeout(this.timeout),console.log("setting timeout"),this.timeout=setTimeout(t,500)):t()},n.prototype.addSub=function(t){return this.subs.push(t)},n}(s),o=w.ObsArray=function(){function t(t){var n,r=this;this.xs=t,this.xs=null!=(n=this.xs)?n:[],this.onChange=new u(function(){return[[0,[],r.xs]]})}return t.prototype.all=function(){var t=this;return m.sub(function(n){return t.onChange.sub(function(){return n.refresh()})}),this.xs},t.prototype.at=function(t){var n=this;return m.sub(function(r){return n.onChange.sub(function(n){var e,u,i;return u=n[0],i=n[1],e=n[2],u===t?r.refresh():void 0})}),this.xs[t]},t.prototype.length=function(){var t=this;return m.sub(function(n){return t.onChange.sub(function(t){var r,e,u;return e=t[0],u=t[1],r=t[2],u.length!==r.length?n.refresh():void 0})}),this.xs.length},t.prototype.map=function(t){var n;return n=new i,this.onChange.sub(function(r){var e,u,i;return u=r[0],i=r[1],e=r[2],n.realSplice(u,i.length,e.map(t))}),n},t.prototype.realSplice=function(t,n,r){var e;return e=this.xs.splice.apply(this.xs,[t,n].concat(r)),this.onChange.pub([t,e,r])},t}(),a=w.SrcArray=function(t){function n(){return k=n.__super__.constructor.apply(this,arguments)}return O(n,t),n.prototype.spliceArray=function(t,n,r){return m.warnMutate(),this.realSplice(t,n,r)},n.prototype.splice=function(){var t,n,r;return r=arguments[0],n=arguments[1],t=arguments.length>=3?R.call(arguments,2):[],this.spliceArray(r,n,t)},n.prototype.insert=function(t,n){return this.splice(n,0,t)},n.prototype.remove=function(t){return this.removeAt(_(this.all()).indexOf(t))},n.prototype.removeAt=function(t){return this.splice(t,1)},n.prototype.push=function(t){return this.splice(this.length(),0,t)},n.prototype.put=function(t,n){return this.splice(t,1,n)},n.prototype.replace=function(t){return this.spliceArray(0,this.length(),t)},n}(o),i=w.MappedDepArray=function(t){function n(){return M=n.__super__.constructor.apply(this,arguments)}return O(n,t),n}(o),t=w.DepArray=function(t){function r(t){this.f=t,r.__super__.constructor.call(this),new n(this.f).onSet.sub(function(t){var n,r,e,u,i,o,s;return u=t[0],i=t[1],o=firstWhere(function(){s=[];for(var t=0,n=Math.min(u.length,i.length);n>=0?n>=t:t>=n;n>=0?t++:t--)s.push(t);return s}.apply(this),function(t){return u[t]!==i[t]}),e=o[0],e=o[1],e>-1?(r=u.length-e,n=i.slice(e),this.realSplice(e,r,n)):void 0})}return O(r,t),r}(o),c=w.ObsMap=function(){function t(t){this.x=null!=t?t:{},this.onAdd=new u(function(){var n,r,e;e=[];for(n in t)r=t[n],e.push([n,r]);return e}),this.onRemove=new u,this.onChange=new u}return t.prototype.get=function(t){var n=this;return m.sub(function(r){return n.onChange.sub(function(n){var e,u,i;return u=n[0],e=n[1],i=n[2],t===u?r.refresh():void 0})}),this.x[t]},t.prototype.all=function(){var t=this;return m.sub(function(n){return t.onChange.sub(function(){return n.refresh()})}),_.clone(this.x)},t.prototype.realPut=function(t,n){var r;return P.call(this.x,t)>=0?(r=this.x[t],this.x[t]=n,this.onChange.pub([t,r,n]),r):(this.x[t]=n,this.onAdd.pub([t,n]),void 0)},t.prototype.realRemove=function(t){var n;return n=x(this.x,t),this.onRemove.pub([t,n]),n},t}(),f=w.SrcMap=function(t){function n(){return A=n.__super__.constructor.apply(this,arguments)}return O(n,t),n.prototype.put=function(t,n){return m.warnMutate(),this.realPut(t,n)},n.prototype.remove=function(t){return m.warnMutate(),this.realRemove(t)},n}(c),e=w.DepMap=function(t){function r(t){this.f=t,r.__super__.constructor.call(this),new n(this.f).onSet.sub(function(t){var n,r,e,u,i;r=t[0],u=t[1];for(n in r)e=r[n],!n in u&&this.realRemove(n);i=[];for(n in u)e=u[n],this.x[n]!==e?i.push(this.realPut(n,e)):i.push(void 0);return i})}return O(r,t),r}(c),_.extend(w,{cell:function(t){return new p(t)},array:function(t){return new a(t)},map:function(t){return new f(t)},depCell:function(t){return new n(t)},lagDepCell:function(t,r){return new n(t,r,!0)},depMap:function(t){return new DepMap(t)},depArray:function(n){return new t(n)}}),$.fn.rx=function(t){var n,r,e,u;return e=$(this).data("rx-map"),null==e&&(e=$(this).data("rx-map",mkMap())),P.call(e,t)>=0?e[t]:e[t]=function(){switch(t){case"focused":return r=w.cell($(this).is(":focus")),$(this).focus(function(){return r.set(!0)}),$(this).blur(function(){return r.set(!1)}),l(function(){return r.get()});case"val":return u=w.cell($(this).val()),$(this).change(function(){return u.set(u)}),l(function(){return u.get()});case"checked":return n=w.cell($(this).is(":checked")),$(this).change(function(){return n.set($(this).is(":checked"))}),l(function(){return n.get()});default:throw"Unknown reactive property type"}}.call(this)},"undefined"==typeof exports?this.rxt=C={}:C=exports,C.mktag=y=function(t){return function(n,r){var e,u,i,c,h,a;e=$("<"+t+"/>"),h=_.omit(n,"init");for(u in h)c=h[u],c instanceof s?function(t){return c.onSet.sub(function(n){var r,u;return r=n[0],u=n[1],e.attr(t,u)})}(u):e.attr(u,c);if(null!=r)if(i=function(t){var n,r,u,i;if(e.html(""),t instanceof Array){for(i=[],r=0,u=t.length;u>r;r++)n=t[r],_.isString(n)&&(n=$("<span/>").text(n)),i.push(e.append(n));return i}throw"Unknown type for contents: "+t.constructor.name},r instanceof o)r.onChange.sub(function(t){var n,r,u,i,o;return u=t[0],i=t[1],n=t[2],e.children().slice(u,u+i.length).remove(),o=$(function(){var t,e,u;for(u=[],t=0,e=n.length;e>t;t++)r=n[t],u.push(r.get(0));return u}()),u===e.children().length?e.append(o):e.children().slice(u,u+1).before(o)});else if(r instanceof s)r.onSet.sub(function(t){var n,r;return n=t[0],r=t[1],i(r)});else{if(!(r instanceof Array))throw"Unknown type for contents: "+r.constructor.name;i(r)}return null!=(a=n.init)&&a.call(e),e}},C.p=y("p"),C.br=y("br")({},[]),C.ul=y("ul"),C.li=y("li"),C.span=y("span"),C.anchor=y("a"),C.div=y("div"),C.input=y("input"),C.select=y("select"),C.option=y("option"),C.label=y("label"),C.button=y("button"),C.fieldset=y("fieldset"),C.legend=y("legend"),C.section=y("section"),C.header=y("header"),C.footer=y("footer"),C.strong=y("strong"),C.h1=y("h1"),C.h2=y("h2"),C.h3=y("h3"),C.h4=y("h4"),C.h5=y("h5"),C.h6=y("h6"),C.h7=y("h7")}).call(this);